<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Deepanraj A ‚Äî Data Analyst | BI Developer | AI-Driven Insights</title>

  <!-- SEO -->
  <meta name="description" content="Portfolio of Deepanraj A ‚Äî Data Analyst & BI Developer specializing in Power BI, Tableau, SQL, Python, Excel, and AI-powered automation including resume and dashboard generators.">
  <meta name="keywords" content="Data Analyst, Power BI, Tableau, SQL, Python, Excel, Dashboard, KPI, AI, Resume Generator, Data Lab">

  <!-- Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-7W7ZPK3K34"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-7W7ZPK3K34');
  </script>

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <!-- PapaParse -->
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
  <!-- SQL.js -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/sql.js/1.8.0/sql-wasm.js"></script>

  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    :root{
      --bg:#f5f5f5;
      --bg-card:#ffffff;
      --bg-soft:#f3f4f6;
      --border:#e5e7eb;
      --text:#111827;
      --text-soft:#4b5563;
      --primary:#2563eb;
      --primary-soft:#dbeafe;
      --sidebar-bg:#0f172a;
      --sidebar-text:#e5e7eb;
    }
    body{
      font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;
      background:var(--bg);
      color:var(--text);
      line-height:1.6;
      overflow-x:hidden;
    }

    /* Dark mode */
    body.dark-mode{
      --bg:#020617;
      --bg-card:#020617;
      --bg-soft:#0f172a;
      --border:#1f2937;
      --text:#e5e7eb;
      --text-soft:#9ca3af;
      --primary:#60a5fa;
      --primary-soft:#1d4ed8;
    }

    /* Layout */
    .app{
      display:flex;
      min-height:100vh;
    }

    /* Sidebar */
    .sidebar{
      width:260px;
      background:var(--sidebar-bg);
      color:var(--sidebar-text);
      padding:20px 18px;
      display:flex;
      flex-direction:column;
      position:fixed;
      top:0;bottom:0;left:0;
    }
    .sidebar-header{
      display:flex;align-items:center;gap:12px;margin-bottom:24px;
    }
    .sidebar-photo{
      width:56px;height:56px;border-radius:50%;
      border:3px solid var(--primary);
      box-shadow:0 0 18px rgba(37,99,235,0.7);
      overflow:hidden;flex-shrink:0;
    }
    .sidebar-photo img{
      width:100%;height:100%;object-fit:cover;
    }
    .sidebar-name{
      font-size:16px;font-weight:700;
    }
    .sidebar-role{
      font-size:12px;color:#9ca3af;
    }
    .sidebar-nav{
      margin-top:10px;
    }
    .sidebar-nav button{
      width:100%;text-align:left;border:none;outline:none;
      background:transparent;color:#cbd5f5;
      padding:10px 10px;border-radius:8px;margin-bottom:5px;
      font-size:14px;display:flex;align-items:center;gap:10px;
      cursor:pointer;transition:.2s;
    }
    .sidebar-nav button span.icon{
      width:22px;text-align:center;
    }
    .sidebar-nav button.active,
    .sidebar-nav button:hover{
      background:rgba(37,99,235,0.18);
      color:#fff;
    }
    .sidebar-footer{
      margin-top:auto;
      font-size:12px;
      color:#6b7280;
    }

    /* Dark toggle */
    #darkToggle{
      position:fixed;bottom:20px;right:20px;
      padding:12px 14px;border-radius:50%;
      background:var(--primary);color:#fff;font-weight:700;
      cursor:pointer;z-index:9999;font-size:18px;
      box-shadow:0 4px 12px rgba(0,0,0,.25);
    }

    /* Main */
    .main{
      margin-left:260px;
      width:calc(100% - 260px);
      padding:20px;
    }

    /* Loader */
    #loaderOverlay{
      position:fixed;top:0;left:0;width:100%;height:100%;
      background:#ffffff;display:flex;align-items:center;
      justify-content:center;z-index:999999;
    }
    .loader-ring{
      border:6px solid #e5e7eb;border-top:6px solid #2563eb;
      width:60px;height:60px;border-radius:50%;animation:spin 1s linear infinite;
    }
    @keyframes spin{100%{transform:rotate(360deg)}}

    /* Sections */
    .page-section{
      display:none;
      animation:fadeIn .4s ease;
    }
    .page-section.active{
      display:block;
    }
    @keyframes fadeIn{
      from{opacity:0;transform:translateY(10px);}
      to{opacity:1;transform:translateY(0);}
    }

    /* HERO */
    .hero{
      background:var(--bg-card);
      padding:32px 26px;
      border-radius:20px;
      border:1px solid var(--border);
      box-shadow:0 12px 30px rgba(15,23,42,.12);
      margin-bottom:24px;
      position:relative;
      overflow:hidden;
    }
    .hero::after{
      content:"";
      position:absolute;
      right:-80px;top:-80px;
      width:220px;height:220px;
      background:radial-gradient(circle at center,rgba(37,99,235,0.16),transparent 60%);
      pointer-events:none;
    }
    .profile-wrapper{
      display:flex;align-items:center;gap:30px;
    }
    .profile-photo-main{
      width:150px;height:150px;border-radius:50%;
      border:4px solid var(--primary);
      box-shadow:0 0 30px rgba(37,99,235,0.8);
      overflow:hidden;flex-shrink:0;
    }
    .profile-photo-main img{
      width:100%;height:100%;object-fit:cover;
    }
    .profile-info h1{
      font-size:32px;font-weight:800;margin-bottom:4px;color:var(--text);
    }
    .profile-title{
      font-size:16px;font-weight:600;color:var(--primary);margin-bottom:8px;
    }
    .profile-subtitle{
      font-size:14px;color:var(--text-soft);margin-bottom:10px;
    }
    .value-statement{
      font-size:14px;font-weight:500;color:var(--text);
      margin-bottom:12px;
    }
    .profile-tags span{
      display:inline-block;font-size:11px;
      background:var(--primary-soft);color:var(--primary);
      padding:4px 9px;border-radius:999px;margin-right:6px;margin-bottom:4px;
    }
    .profile-social{
      display:flex;gap:10px;margin:12px 0 16px;
    }
    .social-icon{
      width:34px;height:34px;border-radius:50%;background:#e5e7eb;
      display:flex;align-items:center;justify-content:center;
      color:var(--primary);font-size:18px;text-decoration:none;transition:.2s;
    }
    .social-icon:hover{
      background:var(--primary);color:#fff;transform:translateY(-2px);
    }
    .hero-actions{
      display:flex;flex-wrap:wrap;gap:10px;margin-top:6px;
    }
    .btn{
      display:inline-block;padding:10px 22px;border-radius:999px;
      font-size:14px;font-weight:600;border:none;cursor:pointer;
      transition:.2s;text-decoration:none;
    }
    .btn-primary{
      background:var(--primary);color:#fff;
    }
    .btn-primary:hover{
      box-shadow:0 4px 12px rgba(37,99,235,0.4);
      transform:translateY(-1px);
    }
    .btn-outline{
      background:transparent;border:1px solid var(--primary);
      color:var(--primary);
    }
    .btn-outline:hover{
      background:var(--primary);color:#fff;
    }
    .btn-secondary{
      background:var(--bg-soft);
      color:var(--text);
      border:1px solid var(--border);
    }
    .btn-secondary:hover{
      background:var(--primary-soft);color:var(--primary);
    }
    .btn-sm{
      font-size:12px;
      padding:6px 14px;
      border-radius:999px;
      border:1px solid var(--primary);
      color:var(--primary);
      background:transparent;
      text-decoration:none;
      cursor:pointer;
      display:inline-block;
    }
    .btn-sm:hover{
      background:var(--primary);color:#fff;
    }

    /* Generic section card */
    .section{
      background:var(--bg-card);
      margin-bottom:20px;padding:24px 20px;
      border-radius:14px;border:1px solid var(--border);
    }
    .section h2{
      font-size:20px;margin-bottom:16px;
      display:flex;align-items:center;gap:10px;color:var(--text);
    }
    .section h2::before{
      content:"";width:4px;height:22px;background:var(--primary);border-radius:2px;
    }

    /* Overview cards */
    .overview-grid{
      display:flex;flex-wrap:wrap;gap:16px;justify-content:flex-start;
    }
    .overview-card{
      width:180px;background:#ffffff;
      padding:22px;border-radius:10px;
      border:2px solid var(--primary);
      text-align:center;
      box-shadow:0 4px 12px rgba(37,99,235,0.2);
    }
    .overview-card .num{
      font-size:32px;font-weight:700;color:var(--primary);margin-bottom:4px;
    }
    .overview-card .label{
      font-size:13px;color:var(--text-soft);
    }

    /* About */
    .about-grid{
      display:grid;
      grid-template-columns:2fr 1.2fr;
      gap:20px;
    }
    @media(max-width:900px){
      .about-grid{grid-template-columns:1fr;}
    }
    .about-highlights li{
      margin-left:18px;
      font-size:14px;
      color:var(--text-soft);
      margin-bottom:4px;
    }

    /* Skills */
    .skills-layout{
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
      gap:16px;
    }
    .skill-block{
      background:var(--bg-soft);
      border-radius:10px;
      border:1px solid var(--border);
      padding:14px;
    }
    .skill-block h3{
      font-size:15px;margin-bottom:8px;color:var(--text);
    }
    .skill-tags{
      display:flex;flex-wrap:wrap;gap:6px;
    }
    .skill-tag{
      font-size:11px;padding:4px 9px;border-radius:999px;
      background:var(--primary-soft);color:var(--primary);
    }

    /* Projects */
    .projects-grid{
      display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));
      gap:18px;
    }
    .project-card{
      background:var(--bg-soft);padding:16px;border-radius:10px;
      border-top:4px solid var(--primary);
    }
    .project-card img{
      width:100%;border-radius:10px;margin-bottom:8px;
      cursor:zoom-in;
    }
    .project-card h3{
      font-size:17px;color:#dc2626;font-weight:700;margin-bottom:4px;
    }
    .project-card p{
      font-size:13px;color:var(--text-soft);margin-bottom:8px;
    }
    .tag-pill{
      display:inline-block;background:var(--primary-soft);
      color:var(--primary);padding:4px 10px;
      border-radius:999px;font-size:11px;margin-right:4px;margin-bottom:4px;
    }
    .project-actions{
      margin-top:8px;display:flex;flex-wrap:wrap;gap:8px;
    }

    /* Experience / Education */
    .job{
      margin-bottom:20px;
    }
    .job h3{
      font-size:16px;color:#dc2626;font-weight:700;
    }
    .job .company{
      color:#2563eb;font-weight:600;font-size:14px;
    }
    .job .dates{
      color:#666;font-size:13px;margin-bottom:6px;
    }
    .job p{
      font-size:14px;color:#111827;
    }

    /* Certifications */
    .cert-grid{
      display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));
      gap:16px;
    }
    .cert-card{
      background:#ffffff;padding:20px;border-radius:10px;
      border:2px solid #2563eb;
      box-shadow:0 4px 12px rgba(37,99,235,0.15);
    }
    .cert-card img{
      width:80px;height:80px;object-fit:contain;margin-bottom:12px;
    }
    .cert-card h3{
      font-size:15px;margin-bottom:6px;color:#111827;
    }
    .cert-card p{
      font-size:12px;color:#2563eb;font-weight:600;
    }

    /* Contact */
    .contact-form{
      max-width:480px;
    }
    .contact-form input,.contact-form textarea{
      width:100%;padding:10px;border-radius:8px;
      border:1px solid var(--border);font-size:14px;
      margin-bottom:10px;background:var(--bg-card);color:var(--text);
    }
    .contact-form textarea{min-height:120px;resize:vertical;}
    .contact-info p{
      font-size:14px;
    }

    /* Data Lab */
    .grid-2{
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(280px,1fr));
      gap:16px;
    }
    .panel{
      background:var(--bg-soft);border-radius:10px;
      border:1px solid var(--border);padding:14px;
    }
    .panel-header{
      font-size:13px;color:var(--text-soft);
      margin-bottom:6px;
    }
    .label-small{
      font-size:12px;font-weight:600;margin-bottom:4px;color:var(--text-soft);
    }
    .panel textarea,.panel input,.panel select{
      width:100%;padding:8px;border-radius:8px;
      border:1px solid var(--border);font-size:12px;
      background:var(--bg-card);color:var(--text);
    }
    .panel textarea{min-height:80px;resize:vertical;}
    .panel button{
      margin-top:6px;
    }

    table{
      width:100%;border-collapse:collapse;font-size:12px;margin-top:6px;
    }
    th,td{
      border:1px solid var(--border);padding:4px 6px;text-align:left;
    }
    th{background:var(--bg-soft);}

    /* Chat / AI assistant */
    .chat-box{
      max-height:260px;overflow-y:auto;
      background:var(--bg-soft);border-radius:10px;
      border:1px solid var(--border);padding:8px;font-size:12px;
    }
    .chat-msg{margin-bottom:6px;}
    .chat-me{text-align:right;}
    .chat-me span{
      display:inline-block;background:var(--primary);color:#fff;
      padding:5px 9px;border-radius:999px;
    }
    .chat-bot span{
      display:inline-block;background:var(--bg-card);color:var(--text);
      padding:5px 9px;border-radius:999px;
    }

    /* Gallery modal */
    #galleryModal{
      position:fixed;top:0;left:0;width:100%;height:100%;
      background:rgba(0,0,0,.8);display:none;
      align-items:center;justify-content:center;z-index:9998;
    }
    #galleryModal img{
      width:80%;max-width:1000px;border-radius:12px;
      box-shadow:0 0 20px rgba(255,255,255,.3);
    }

    /* Floating chat button (global) */
    #chatBtn{
      position:fixed;right:20px;bottom:80px;background:var(--primary);
      color:#fff;border-radius:50%;width:48px;height:48px;
      display:flex;align-items:center;justify-content:center;
      cursor:pointer;font-size:22px;z-index:9999;
      box-shadow:0 4px 14px rgba(0,0,0,.3);
    }
    #chatWindow{
      position:fixed;right:20px;bottom:140px;width:330px;height:420px;
      background:var(--bg-card);border-radius:15px;
      box-shadow:0 0 20px rgba(0,0,0,.4);
      overflow:hidden;display:none;flex-direction:column;z-index:9999;
    }

    /* Data Lab internal layout */
    .dl-two-col{display:grid;grid-template-columns:1.2fr 1fr;gap:10px;}
    @media(max-width:800px){.dl-two-col{grid-template-columns:1fr;}}

    /* Responsive */
    @media(max-width:900px){
      .sidebar{
        position:fixed;left:0;top:0;bottom:auto;
        width:100%;height:auto;flex-direction:row;
        align-items:center;gap:10px;
      }
      .sidebar-nav{
        display:flex;flex-wrap:wrap;
      }
      .sidebar-footer{display:none;}
      .main{
        margin-left:0;margin-top:120px;width:100%;
      }
      .profile-wrapper{flex-direction:column;text-align:left;}
    }
    @media(max-width:600px){
      .profile-wrapper{flex-direction:column;text-align:center;}
      .profile-info{text-align:center;}
      .hero-actions{justify-content:center;}
    }
  </style>
</head>
<body>

<!-- LOADING OVERLAY -->
<div id="loaderOverlay">
  <div class="loader-ring"></div>
</div>

<!-- DARK MODE TOGGLE -->
<div id="darkToggle">üåô</div>

<!-- GALLERY MODAL -->
<div id="galleryModal" onclick="this.style.display='none'">
  <img id="galleryImage" alt="Preview">
</div>

<!-- APP LAYOUT -->
<div class="app">

  <!-- SIDEBAR -->
  <aside class="sidebar">
    <div>
      <div class="sidebar-header">
        <div class="sidebar-photo">
          <img src="images/Photo.jpeg" alt="Deepanraj A">
        </div>
        <div>
          <div class="sidebar-name">Deepanraj A</div>
          <div class="sidebar-role">Data Analyst ‚Ä¢ BI ‚Ä¢ AI</div>
        </div>
      </div>

      <div class="sidebar-nav">
        <button class="nav-btn active" data-section="home">
          <span class="icon">üè†</span> <span>Home / Portfolio</span>
        </button>
        <button class="nav-btn" data-section="datalab">
          <span class="icon">üß™</span> <span>Data Lab</span>
        </button>
        <button class="nav-btn" data-section="assistant">
          <span class="icon">ü§ñ</span> <span>AI Assistant</span>
        </button>
        <button class="nav-btn" data-section="contact">
          <span class="icon">üì¨</span> <span>Contact</span>
        </button>
      </div>
    </div>

    <div class="sidebar-footer">
      ¬© 2025 ‚Ä¢ Deepanraj A
    </div>
  </aside>

  <!-- MAIN CONTENT -->
  <main class="main">

    <!-- HOME / PORTFOLIO SECTION -->
    <section id="home" class="page-section active">

      <!-- HERO -->
      <div class="hero">
        <div class="profile-wrapper">
          <div class="profile-photo-main">
            <img src="images/Photo.jpeg" alt="Deepanraj A">
          </div>
          <div class="profile-info">
            <h1>Deepanraj A</h1>
            <div class="profile-title">Data Analyst | BI Developer | AI-Driven Insights</div>
            <div class="profile-subtitle">
              Based in Karur, Tamil Nadu, India.
            </div>
            <div class="value-statement">
              ‚ÄúTransforming raw data into meaningful insights with analytics, automation, and AI.‚Äù
            </div>
            <div class="profile-tags">
              <span>Python</span><span>SQL</span><span>Power BI</span>
              <span>Tableau</span><span>Machine Learning</span><span>AI Automation</span>
            </div>
            <div class="profile-social">
              <a href="https://linkedin.com/in/deepanraj-data-analyst" class="social-icon" target="_blank">in</a>
              <a href="https://github.com/deeepanbe?tab=repositories" class="social-icon" target="_blank">‚öô</a>
            </div>
            <div class="hero-actions">
              <a href="resume/Deepanraj_A_Data_Analyst.pdf" class="btn btn-primary" target="_blank">Download Resume</a>
              <button class="btn btn-secondary" onclick="scrollToProjects()">View Projects</button>
              <button class="btn btn-outline" onclick="openDataLab()">Open Data Lab (AI Tools)</button>
            </div>
          </div>
        </div>
      </div>

      <!-- ABOUT ME -->
      <div class="section">
        <h2>ABOUT ME</h2>
        <div class="about-grid">
          <div>
            <p style="font-size:14px;margin-bottom:8px;">
              I am a Data Analyst and BI Developer with a strong foundation in Mechanical/Quality Engineering and 9+ years of total experience.
              Over the last few years, I have transitioned into data analytics, focusing on building automated reporting, KPI frameworks, and AI-assisted analytics tools.
            </p>
            <p style="font-size:14px;margin-bottom:8px;">
              I work with <b>Power BI, Tableau, SQL, Python, and Excel</b> to design dashboards, data pipelines, and decision-support systems. I also build
              AI-powered automation such as <b>ATS-optimized resume generators</b> and a <b>Data Lab engine</b> that can auto-suggest KPIs, SQL, and BI layouts.
            </p>
            <p style="font-size:14px;margin-bottom:8px;">
              My strengths include <b>data cleaning</b>, <b>dashboarding</b>, <b>KPI generation</b>, and <b>process automation</b>.  
              I build reliable analytics systems that help businesses make confident decisions.
            </p>
          </div>
          <div>
            <ul class="about-highlights">
              <li>Transitioned from Mechanical / Quality Engineering into Data Analytics.</li>
              <li>Hands-on with Power BI, Tableau, SQL, Python (Pandas, NumPy, Matplotlib), and Excel.</li>
              <li>Created AI-based Resume Generator and AI Data Lab for KPI & dashboard automation.</li>
              <li>Experienced in HR, Sales, Operations, Manufacturing and Business Intelligence reporting.</li>
            </ul>
          </div>
        </div>
      </div>

      <!-- OVERVIEW -->
      <div class="section">
        <h2>OVERVIEW</h2>
        <div class="overview-grid">
          <div class="overview-card">
            <div class="num">9</div>
            <div class="label">Years Experience</div>
          </div>
          <div class="overview-card">
            <div class="num">4</div>
            <div class="label">Years Education</div>
          </div>
          <div class="overview-card">
            <div class="num">2</div>
            <div class="label">Languages</div>
          </div>
          <div class="overview-card">
            <div class="num">6</div>
            <div class="label">Certificates</div>
          </div>
        </div>
      </div>

      <!-- SKILLS -->
      <div class="section">
        <h2>SKILLS</h2>
        <div class="skills-layout">
          <div class="skill-block">
            <h3>üüß Technical Skills</h3>
            <div class="skill-tags">
              <span class="skill-tag">Python (Pandas, NumPy, Matplotlib)</span>
              <span class="skill-tag">SQL (Joins, CTE, Window Functions)</span>
              <span class="skill-tag">Power BI (DAX, Power Query)</span>
              <span class="skill-tag">Tableau (LOD, Storyboards)</span>
              <span class="skill-tag">Excel (PivotTable, INDEX-MATCH, Power Query)</span>
            </div>
          </div>
          <div class="skill-block">
            <h3>üü¶ Analytics Skills</h3>
            <div class="skill-tags">
              <span class="skill-tag">Data Cleaning</span>
              <span class="skill-tag">Exploratory Data Analysis</span>
              <span class="skill-tag">KPI Framework Development</span>
              <span class="skill-tag">Statistical Analysis</span>
              <span class="skill-tag">Forecasting</span>
              <span class="skill-tag">Business Insights</span>
            </div>
          </div>
          <div class="skill-block">
            <h3>üü© Tools & Platforms</h3>
            <div class="skill-tags">
              <span class="skill-tag">Power BI</span>
              <span class="skill-tag">Tableau</span>
              <span class="skill-tag">Excel</span>
              <span class="skill-tag">Python</span>
              <span class="skill-tag">MySQL / PostgreSQL</span>
              <span class="skill-tag">Git / GitHub</span>
              <span class="skill-tag">ChatGPT & AI Tools</span>
            </div>
          </div>
        </div>
      </div>

      <!-- PROJECTS -->
      <div class="section" id="projects-section">
        <h2>PROJECTS</h2>
        <div class="projects-grid">
          <div class="project-card">
            <img src="Thumbnail/sales_thumb.png" alt="Sales Dashboard">
            <h3>Sales Performance Dashboard ‚Äì Power BI</h3>
            <p>
              Interactive Power BI dashboard visualizing revenue, product performance, regional trends, and customer segments.
              Includes drill-down, YoY comparison, and dynamic filters.
            </p>
            <span class="tag-pill">Power BI</span>
            <span class="tag-pill">SQL</span>
            <span class="tag-pill">Excel</span>
            <div class="project-actions">
              <a href="#" class="btn-sm">View Dashboard</a>
              <a href="https://github.com/deeepanbe" target="_blank" class="btn-sm">View Code</a>
            </div>
          </div>

          <div class="project-card">
            <img src="Thumbnail/churn_thumb.png" alt="Customer Churn Analysis">
            <h3>Customer Churn Analysis ‚Äì ML</h3>
            <p>
              Predictive model using Python and Machine Learning to identify at-risk customers, with feature importance and retention recommendations.
            </p>
            <span class="tag-pill">Python</span>
            <span class="tag-pill">Scikit-Learn</span>
            <span class="tag-pill">Pandas</span>
            <div class="project-actions">
              <a href="https://github.com/deeepanbe" target="_blank" class="btn-sm">View Notebook</a>
            </div>
          </div>

          <div class="project-card">
            <img src="Thumbnail/hr_thumb.png" alt="HR Analytics">
            <h3>HR Analytics Dashboard ‚Äì Tableau</h3>
            <p>
              HR dashboard for headcount, attrition, performance, and diversity metrics to support workforce planning and HR strategy.
            </p>
            <span class="tag-pill">Tableau</span>
            <span class="tag-pill">Excel</span>
            <span class="tag-pill">HR Analytics</span>
            <div class="project-actions">
              <a href="#" class="btn-sm">View Dashboard</a>
            </div>
          </div>

          <div class="project-card">
            <img src="Thumbnail/resume_ai.png" alt="AI Resume Generator">
            <h3>AI Resume Auto-Generator</h3>
            <p>
              Google Apps Script + AI pipeline that converts a Job Description into an ATS-friendly resume PDF/DOCX tailored to the role and keywords.
            </p>
            <span class="tag-pill">Apps Script</span>
            <span class="tag-pill">AI</span>
            <span class="tag-pill">Automation</span>
            <div class="project-actions">
              <a href="#resume" class="btn-sm" onclick="openResumeSection()">Use Tool</a>
              <a href="https://github.com/deeepanbe" target="_blank" class="btn-sm">View Code</a>
            </div>
          </div>

          <div class="project-card">
            <img src="Thumbnail/datalab_ai.png" alt="AI Data Lab">
            <h3>AI Data Lab Engine</h3>
            <p>
              Web-based workspace that accepts CSV/Excel files and supports SQL playground, quick insights, KPI generation templates and BI dashboard blueprints.
              Designed to work with Comet/AI assistant.
            </p>
            <span class="tag-pill">JavaScript</span>
            <span class="tag-pill">SQL.js</span>
            <span class="tag-pill">Chart.js</span>
            <div class="project-actions">
              <button class="btn-sm" onclick="openDataLab()">Open Data Lab</button>
              <a href="https://github.com/deeepanbe" target="_blank" class="btn-sm">View Implementation</a>
            </div>
          </div>
        </div>
        <div style="margin-top:14px;">
          <a href="https://github.com/deeepanbe?tab=repositories" target="_blank" style="color:var(--primary);font-weight:600;text-decoration:none;">
            View More Projects on GitHub ‚Üí
          </a>
        </div>
      </div>

      <!-- EXPERIENCE -->
      <div class="section">
        <h2>EXPERIENCE</h2>
        <div class="job">
          <h3>Junior Data Analyst</h3>
          <div class="company">DAKSHIN HOME FASHIONS</div>
          <div class="dates">Mar 2021 - Present</div>
          <p>
            Leading data analysis initiatives across production and operations, automating reports, and building dashboards in Excel and BI tools
            to improve efficiency, reduce defects, and support management decisions.
          </p>
        </div>
        <div class="job">
          <h3>Quality Engineer</h3>
          <div class="company">PILOT INDUSTRIES</div>
          <div class="dates">Feb 2018 - Feb 2021</div>
          <p>
            Developed strong foundations in quality processes, RCA, process improvement and KPI tracking using data, which now support
            my analytics approach in BI and reporting.
          </p>
        </div>
      </div>

      <!-- EDUCATION -->
      <div class="section">
        <h2>EDUCATION</h2>
        <div class="job">
          <h3>Bachelor of Engineering - Mechanical</h3>
          <div class="company">Pavai College of Technology</div>
          <div class="dates">June 2012 - April 2016</div>
          <p>
            Built strong foundations in mathematics, statistics, and problem-solving that support analytical thinking and data-driven decision-making.
          </p>
        </div>
      </div>

      <!-- CERTIFICATIONS -->
      <div class="section">
        <h2>CERTIFICATIONS</h2>
        <div class="cert-grid">
          <div class="cert-card">
            <img src="images/logo/GOOGLE.jfif" alt="Google">
            <h3>Google Data Analytics / Docs</h3>
            <p>Google ‚Äî 2024</p>
          </div>
          <div class="cert-card">
            <img src="images/logo/EDURAKA.png" alt="Edureka">
            <h3>Business Analyst Masters</h3>
            <p>Edureka ‚Äî Completion Expected Mar 2025</p>
          </div>
          <div class="cert-card">
            <img src="images/logo/POWERBI.jfif" alt="Microsoft">
            <h3>Microsoft SQL / Power BI</h3>
            <p>Microsoft ‚Äî 2025</p>
          </div>
          <div class="cert-card">
            <img src="images/logo/TABLEAU.png" alt="Tableau">
            <h3>Tableau Certification</h3>
            <p>Tableau ‚Äî Dec 2024</p>
          </div>
        </div>
      </div>

      <!-- CONTACT (inside Home) -->
      <div id="contact-section" class="section">
        <h2>CONTACT</h2>
        <p style="margin-bottom:10px;color:var(--text-soft);">
          If you‚Äôd like to discuss a role, project, or collaboration, use the form below or contact me directly.
        </p>

        <div style="display:grid;grid-template-columns:1.2fr 1fr;gap:20px;flex-wrap:wrap;">
          <form class="contact-form" action="https://formspree.io/f/mnnqanpn" method="POST">
            <input type="text" name="name" placeholder="Name *" required>
            <input type="email" name="email" placeholder="Email *" required>
            <textarea name="message" placeholder="Message *" required></textarea>
            <button type="submit" class="btn btn-primary" style="width:100%;">Send Message</button>
          </form>

          <div class="contact-info">
            <p>üìß <b>deepanraj.a@outlook.com</b></p>
            <p>üìß <b>info@deepanraj.work.gd</b></p>
            <p>üì± <b>8940991095</b></p>
          </div>
        </div>
      </div>

    </section>

          If you‚Äôd like to discuss a role, project, or collaboration, use the form below or contact me directly.
        </p>

        <div style="display:grid;grid-template-columns:1.2fr 1fr;gap:20px;flex-wrap:wrap;">
          <form class="contact-form" action="https://formspree.io/f/mnnqanpn" method="POST">
            <input type="text" name="name" placeholder="Name *" required>
            <input type="email" name="email" placeholder="Email *" required>
            <textarea name="message" placeholder="Message *" required></textarea>
            <button type="submit" class="btn btn-primary" style="width:100%;">Send Message</button>
          </form>

          <div class="contact-info">
            <p>üìß <b>deepanraj.a@outlook.com</b></p>
            <p>üìß <b>info@deepanraj.work.gd</b></p>
            <p>üì± <b>8940991095</b></p>
          </div>
        </div>
      </div>
    </section>

  </main>
</div>

<!-- FLOATING CHAT BUTTON / WINDOW -->
<div id="chatBtn">ü§ñ</div>
<div id="chatWindow">
  <div style="padding:10px;font-size:13px;color:var(--text-soft);">
    <b>Tip:</b> Open the <b>AI Assistant</b> tab in the sidebar for full-screen chat.
  </div>
</div>

<!-- Formula Writer AI Modal -->
<div id="formulaModal" style="display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);justify-content:center;align-items:center;z-index:10000;">
  <div style="background:white;border-radius:12px;padding:30px;width:90%;max-width:600px;box-shadow:0 10px 40px rgba(0,0,0,0.3);">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;">
      <h3 style="margin:0;color:#111827;font-size:22px;">AI Formula Writer</h3>
      <button onclick="closeFormulaModal()" style="background:none;border:none;font-size:24px;cursor:pointer;color:#666;">&times;</button>
    </div>

    <div style="margin-bottom:20px;">
      <label style="display:block;margin-bottom:8px;color:#111827;font-weight:600;">Formula Type:</label>
      <select id="formulaType" style="width:100%;padding:10px;border:1px solid #e5e7eb;border-radius:8px;font-size:14px;">
        <option value="sql">SQL</option>
        <option value="dax">Power BI DAX</option>
        <option value="tableau">Tableau</option>
        <option value="excel">Excel</option>
      </select>
    </div>

    <div style="margin-bottom:20px;">
      <label style="display:block;margin-bottom:8px;color:#111827;font-weight:600;">Describe what you need:</label>
      <textarea id="formulaDesc" placeholder="E.g., Sum of sales by region" style="width:100%;padding:10px;border:1px solid #e5e7eb;border-radius:8px;font-size:14px;min-height:100px;resize:vertical;font-family:sans-serif;"></textarea>
    </div>

    <div style="margin-bottom:20px;">
      <button onclick="generateFormula()" style="background:#2563eb;color:white;border:none;padding:12px 24px;border-radius:8px;font-weight:600;cursor:pointer;width:100%;font-size:14px;">Generate Formula</button>
    </div>

    <div style="margin-bottom:20px;">
      <label style="display:block;margin-bottom:8px;color:#111827;font-weight:600;">Generated Formula:</label>
      <div id="generatedFormula" style="background:#f5f5f5;border:1px solid #e5e7eb;border-radius:8px;padding:15px;font-family:monospace;font-size:13px;color:#111827;min-height:50px;word-break:break-all;">Click Generate to create formula</div>
    </div>

    <div style="display:flex;gap:10px;">
      <button onclick="copyFormula()" style="background:#10b981;color:white;border:none;padding:10px 20px;border-radius:8px;font-weight:600;cursor:pointer;flex:1;font-size:14px;">Copy Formula</button>
      <button onclick="closeFormulaModal()" style="background:#e5e7eb;color:#111827;border:none;padding:10px 20px;border-radius:8px;font-weight:600;cursor:pointer;flex:1;font-size:14px;">Close</button>
    </div>
  </div>
</div>

<script>
  // Loader
  window.addEventListener("load", function(){
    setTimeout(()=>{ document.getElementById("loaderOverlay").style.display="none"; }, 800);
  });

  // Default light mode
  document.body.classList.remove("dark-mode");

  // Dark mode toggle
  document.getElementById("darkToggle").onclick = ()=>{
    document.body.classList.toggle("dark-mode");
  };

  // Navigation between sections
  const navButtons = document.querySelectorAll(".nav-btn");
  const sections = document.querySelectorAll(".page-section");

  navButtons.forEach(btn=>{
    btn.addEventListener("click", ()=>{
      const target = btn.getAttribute("data-section");
      navButtons.forEach(b=>b.classList.remove("active"));
      btn.classList.add("active");
      sections.forEach(sec=>{
        sec.id === target ? sec.classList.add("active") : sec.classList.remove("active");
      });
      window.scrollTo({top:0,behavior:"smooth"});
    });
  });

  function scrollToContact(){
    navButtons.forEach(b=>{
      if(b.getAttribute("data-section")==="home") b.classList.add("active");
      else b.classList.remove("active");
    });
    sections.forEach(sec=>{
      sec.id === "home" ? sec.classList.add("active") : sec.classList.remove("active");
    });
    setTimeout(()=>{
      const c = document.getElementById("contact-section");
      if(c) c.scrollIntoView({behavior:"smooth"});
    },200);
  }

  function scrollToProjects(){
    navButtons.forEach(b=>{
      if(b.getAttribute("data-section")==="home") b.classList.add("active");
      else b.classList.remove("active");
    });
    sections.forEach(sec=>{
      sec.id === "home" ? sec.classList.add("active") : sec.classList.remove("active");
    });
    setTimeout(()=>{
      const p = document.getElementById("projects-section");
      if(p) p.scrollIntoView({behavior:"smooth"});
    },200);
  }

  function openDataLab(){
    navButtons.forEach(b=>{
      if(b.getAttribute("data-section")==="datalab") b.classList.add("active");
      else b.classList.remove("active");
    });
    sections.forEach(sec=>{
      sec.id === "datalab" ? sec.classList.add("active") : sec.classList.remove("active");
    });
    window.scrollTo({top:0,behavior:"smooth"});
  }

  function openResumeSection(){
    navButtons.forEach(b=>{
      if(b.getAttribute("data-section")==="resume") b.classList.add("active");
      else b.classList.remove("active");
    });
    sections.forEach(sec=>{
      sec.id === "resume" ? sec.classList.add("active") : sec.classList.remove("active");
    });
    window.scrollTo({top:0,behavior:"smooth"});
  }

  // Gallery zoom: only on thumbnails
  document.querySelectorAll(".project-card img, .profile-photo-main img").forEach(img=>{
    img.addEventListener("click", ()=>{
      const modal = document.getElementById("galleryModal");
      const gimg = document.getElementById("galleryImage");
      gimg.src = img.src;
      modal.style.display="flex";
    });
  });

  // Floating chat window
  const chatBtn = document.getElementById("chatBtn");
  const chatWindow = document.getElementById("chatWindow");
  chatBtn.onclick = ()=>{
    chatWindow.style.display = (chatWindow.style.display === "flex" ? "none" : "flex");
  };

  // SQL.JS demo DB
  let SQLDB = null;
  initSqlJs({ locateFile:file=>`https://cdnjs.cloudflare.com/ajax/libs/sql.js/1.8.0/${file}` })
    .then(SQL =>{
      SQLDB = new SQL.Database();
      SQLDB.run(`
        CREATE TABLE sales(region TEXT, product TEXT, revenue INT);
        INSERT INTO sales VALUES ('North','Product A',12000);
        INSERT INTO sales VALUES ('South','Product B',8000);
        INSERT INTO sales VALUES ('West','Product C',15000);
        INSERT INTO sales VALUES ('East','Product A',9000);
      `);
    });

  function runSQL(){
    const out = document.getElementById("sqlResult");
    out.innerHTML = "";
    if(!SQLDB){ out.textContent = "Database not ready yet."; return; }

    const query = document.getElementById("sqlInput").value;
    try{
      const res = SQLDB.exec(query);
      if(res.length === 0){
        out.textContent = "Query executed successfully (no rows returned).";
        return;
      }
      const table = document.createElement("table");
      const header = document.createElement("tr");
      res[0].columns.forEach(col=>{
        const th = document.createElement("th");
        th.textContent = col;
        header.appendChild(th);
      });
      table.appendChild(header);
      res[0].values.forEach(row=>{
        const tr = document.createElement("tr");
        row.forEach(val=>{
          const td = document.createElement("td");
          td.textContent = val;
          tr.appendChild(td);
        });
        table.appendChild(tr);
      });
      out.appendChild(table);
    }catch(e){
      out.textContent = "Error: " + e.message;
    }
  }

  function importFileAsTable() {
    const fileInput = document.getElementById('sqlImportFile');
    if (!fileInput.files[0]) {
      alert('Please select a file');
      return;
    }
    const file = fileInput.files[0];
    const reader = new FileReader();
    reader.onload = function(e) {
      const data = e.target.result;
      alert('File imported! (Demo only). You can extend logic to load into SQL.js.\nFile: ' + file.name);
    };
    reader.readAsText(file);
  }

  function exportSQLResult() {
    const out = document.getElementById('sqlResult');
    if (!out || out.textContent.trim() === '') {
      alert('No results to export. Run a query first.');
      return;
    }
    const table = out.querySelector('table');
    if (!table) {
      alert('No table data found to export.');
      return;
    }
    let csv = '';
    const rows = table.querySelectorAll('tr');
    rows.forEach(row => {
      const cols = row.querySelectorAll('th, td');
      const rowData = Array.from(cols).map(col => '"' + col.textContent.trim() + '"').join(',');
      csv += rowData + '\n';
    });
    const blob = new Blob([csv], {type: 'text/csv'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'sql_results.csv';
    a.click();
  }

  // CSV ‚Üí Chart
  let csvChart = null;
  document.getElementById("csvFile").addEventListener("change", function(){
    const file = this.files[0];
    if(!file) return;

    Papa.parse(file,{
      header:true,
      dynamicTyping:true,
      complete:function(result){
        const rows = result.data.filter(r=>Object.keys(r).length>0);
        if(rows.length === 0) return;
        const preview = document.getElementById("csvPreview");

        let html = "<b>Preview (first 5 rows):</b><br><table><tr>";
        const cols = Object.keys(rows[0]);
        cols.forEach(c=> html += `<th>${c}</th>`);
        html += "</tr>";
        rows.slice(0,5).forEach(r=>{
          html += "<tr>";
          cols.forEach(c=> html += `<td>${r[c]}</td>`);
          html += "</tr>";
        });
        html += "</table>";
        preview.innerHTML = html;

        const labels = rows.map(r=> r[cols[0]]);
        let numCol = null;
        for(let i=1;i<cols.length;i++){
          if(typeof rows[0][cols[i]] === "number"){
            numCol = cols[i];break;
          }
        }
        if(!numCol){ return; }
        const data = rows.map(r=> r[numCol]);

        const ctx = document.getElementById("csvChart").getContext("2d");
        if(csvChart) csvChart.destroy();
        csvChart = new Chart(ctx, {
          type:"bar",
          data:{
            labels:labels,
            datasets:[{
              label:numCol,
              data:data,
              backgroundColor:"rgba(37,99,235,0.6)"
            }]
          },
          options:{
            responsive:true,
            plugins:{legend:{labels:{color: getComputedStyle(document.body).getPropertyValue('--text')}}},
            scales:{
              x:{ticks:{color:getComputedStyle(document.body).getPropertyValue('--text-soft')}},
              y:{ticks:{color:getComputedStyle(document.body).getPropertyValue('--text-soft')}}
            }
          }
        });
      }
    });
  });

  // Simple KPI stub (local-only demo)
  function simpleKPIStub(){
    const loader = document.getElementById('kpiLoader');
    const summary = document.getElementById('kpiSummary');
    loader.style.display = 'block';
    setTimeout(()=>{
      const kpis = ['Total Records','Revenue','Customer Growth','Retention Rate','Churn Rate','Average Order Value','Conversion Rate'];
      summary.innerHTML = kpis.map(k => `<div style="margin:4px 0;">‚úì ${k}</div>`).join('') +
        '<div style="margin-top:6px;font-size:11px;color:#6b7280;">(Full auto-KPI, SQL & dashboard spec can be generated via Comet/AI on these containers.)</div>';
      document.getElementById('powerBITemplate').textContent =
        'Revenue = SUMX(Sales, Sales[Quantity] * Sales[Price])\n' +
        'Growth Rate = DIVIDE(THIS_YEAR - LAST_YEAR, LAST_YEAR)';
      document.getElementById('tableauTemplate').textContent =
        'IF SUM([Sales]) > AVG([Average Sales]) THEN "High" ELSE "Low" END';
      document.getElementById('sqlQueries').textContent =
        'SELECT Date, SUM(Amount) AS Daily_Revenue FROM Sales GROUP BY Date;\n' +
        'SELECT CustomerID, COUNT(*) AS Purchase_Count FROM Orders GROUP BY CustomerID;';
      document.getElementById('excelFormula').textContent =
        '=SUM(B2:B100)   // Total\n' +
        '=AVERAGE(B2:B100)   // Average\n' +
        '=IF(B2>C2,"Growing","Declining")   // Trend';
      loader.style.display = 'none';
    },800);
  }

  function copyToClipboard(elementId) {
    const text = document.getElementById(elementId).textContent;
    navigator.clipboard.writeText(text).then(() => alert('Copied!'));
  }

  function downloadExcelReport() {
    const data = document.getElementById('excelFormula').textContent;
    const blob = new Blob([data], { type: 'text/plain' });
    const url = window.URL.createObjectURL(blob);
    const a = document.createElement('a'); a.href = url; a.download = 'KPI_Report.txt'; a.click();
  }

  // Resume Generator helpers
  document.getElementById("rgJD").addEventListener("input", ()=>{
    const jd = document.getElementById("rgJD").value;
    const box = document.getElementById("rgKeywords");
    if(jd.trim().length < 30){
      box.style.display = "none";
      return;
    }
    const keys = ["SQL","Python","Power BI","Tableau","Excel","Machine Learning","ML","Pandas","NumPy","Scikit-Learn","Dashboard","ETL"];
    const found = keys.filter(k=> jd.toLowerCase().includes(k.toLowerCase()));
    if(found.length){
      box.style.display="block";
      box.innerHTML = "<b>Keywords detected:</b> " + found.join(", ");
    }else{
      box.style.display="none";
    }
  });

  function detectRole(jd){
    jd = jd.toLowerCase();
    if(jd.includes("power bi")) return "Power BI Developer";
    if(jd.includes("tableau")) return "Tableau Developer";
    if(jd.includes("machine learning") || jd.includes("ml") || jd.includes("ai")) return "Data Scientist";
    if(jd.includes("business analyst")) return "Business Analyst";
    return "Data Analyst";
  }

  async function generateResume(){
    const company = document.getElementById("rgCompany").value.trim();
    const job = document.getElementById("rgJobTitle").value.trim();
    const jd = document.getElementById("rgJD").value.trim();
    const loader = document.getElementById("rgLoader");
    const result = document.getElementById("rgResult");
    const links = document.getElementById("rgLinks");

    if(!company || !job || !jd){
      alert("Please fill Company, Job Title, and JD.");
      return;
    }
    loader.style.display="block";
    result.style.display="none";
    links.innerHTML="";

    const detectedRole = detectRole(jd);

    try{
      const res = await fetch("https://script.google.com/macros/s/AKfycbxKtgjRe_vZsFbgv3G7Q4KVWAkJUCEn8rTQpreXv-6mw41GmKeQrVmMd649-KDfN9G4xec",{
        method:"POST",
        body:JSON.stringify({
          companyName:company,
          jobTitle:job,
          jobDescription:jd,
          detectedRole:detectedRole,
          output:"pdf-docx"
        })
      });
      const data = await res.json();
      loader.style.display="none";

      if(data.status === "success"){
        result.style.display="block";
        let html="";
        if(data.pdf) html += `<a href="${data.pdf}" target="_blank">Download PDF</a><br>`;
        if(data.docx) html += `<a href="${data.docx}" target="_blank">Download DOCX</a>`;
        links.innerHTML = html || "No download links returned from backend.";
      }else{
        alert("Error generating resume: " + data.message);
      }
    }catch(e){
      loader.style.display="none";
      alert("Error calling backend. Please check your Apps Script URL.");
    }
  }

  // AI Assistant using Vercel backend
  async function sendAssistantMessage(){
    const input = document.getElementById("assistantInput");
    const box = document.getElementById("assistantChatBox");
    const msg = input.value.trim();
    if(!msg) return;

    const me = document.createElement("div");
    me.className="chat-msg chat-me";
    me.innerHTML = `<span>${msg}</span>`;
    box.appendChild(me);
    box.scrollTop = box.scrollHeight;
    input.value="";

    try{
      const res = await fetch("https://YOUR-VERCEL-APP.vercel.app/api/chat",{
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body:JSON.stringify({message:msg})
      });
      const data = await res.json();
      const bot = document.createElement("div");
      bot.className="chat-msg chat-bot";
      bot.innerHTML = `<span>${data.reply || "No reply from AI."}</span>`;
      box.appendChild(bot);
      box.scrollTop = box.scrollHeight;
    }catch(e){
      const err = document.createElement("div");
      err.className="chat-msg chat-bot";
      err.innerHTML = `<span>There was a problem connecting to the AI server.</span>`;
      box.appendChild(err);
      box.scrollTop = box.scrollHeight;
    }
  }

  // Formula modal logic
  function openFormulaAI() {
    document.getElementById('formulaModal').style.display = 'flex';
  }
  function closeFormulaModal() {
    document.getElementById('formulaModal').style.display = 'none';
  }
  function generateFormula() {
    const formulaType = document.getElementById('formulaType').value;
    const description = document.getElementById('formulaDesc').value;
    let formula = '';
    if (!description.trim()) {
      alert('Please describe what you need');
      return;
    }
    if (formulaType === 'sql') {
      formula = 'SELECT Region, SUM(Sales) AS TotalSales FROM YourTable GROUP BY Region;';
    } else if (formulaType === 'dax') {
      formula = 'Sales Amount = SUMX(Sales, Sales[Quantity] * Sales[Price])';
    } else if (formulaType === 'tableau') {
      formula = 'IF SUM([Sales]) > AVG([Sales]) THEN "High" ELSE "Low" END';
    } else if (formulaType === 'excel') {
      formula = '=SUMIFS(Sales_Amount,Region,"South")';
    }
    document.getElementById('generatedFormula').textContent = formula;
  }
  function copyFormula() {
    const formula = document.getElementById('generatedFormula').textContent;
    if (!formula || formula === '') {
      alert('Generate a formula first');
      return;
    }
    navigator.clipboard.writeText(formula).then(() => {
      alert('Formula copied to clipboard!');
    }).catch(() => {
      alert('Failed to copy. Please try again.');
    });
  }

  window.addEventListener('click', function(event) {
    const modal = document.getElementById('formulaModal');
    if (event.target === modal) {
      modal.style.display = 'none';
    }
  });

      // ENHANCEMENT 1: AUTO-KPI GENERATION
  let uploadedData = {};
  function generateKPIs() {
    if (!uploadedData.rows || uploadedData.rows.length === 0) return;
    const rows = uploadedData.rows;
    const kpis = [];
    kpis.push({ name: 'Total Records', value: rows.length, desc: 'Total number of data rows' });
    uploadedData.columns.forEach(col => {
      const vals = rows.map(r => r[col]).filter(v => !isNaN(v) && v !== '');
      if (vals.length > 0) {
        const numVals = vals.map(Number);
        kpis.push({ name: 'Sum_' + col, value: numVals.reduce((a,b) => a+b, 0).toFixed(2), desc: 'Total of ' + col });
        kpis.push({ name: 'Avg_' + col, value: (numVals.reduce((a,b) => a+b, 0)/numVals.length).toFixed(2), desc: 'Average of ' + col });
      }
    });
    let html = '<b>Generated KPIs:</b><table style="width:100%;border:1px solid #ddd;font-size:12px;"><tr><th>KPI</th><th>Value</th><th>Description</th></tr>';
    kpis.forEach(k => html += '<tr><td>' + k.name + '</td><td>' + k.value + '</td><td>' + k.desc + '</td></tr>');
    html += '</table>';
    const kpiDiv = document.getElementById('kpi-output');
    if (kpiDiv) kpiDiv.innerHTML = html;
  }
  
  // ENHANCEMENT 2: SQL QUERY BUILDER
  function buildSQL() {
    if (!uploadedData.columns) return;
    let sql = 'SELECT ';
    sql += uploadedData.columns.slice(0, 3).join(', ');
    sql += ' FROM your_table LIMIT 10;';
    const sqlDiv = document.getElementById('sql-output');
    if (sqlDiv) sqlDiv.innerHTML = '<pre style="background:#f5f5f5;padding:10px;border-radius:5px;">' + sql + '</pre>';
  }
  
  // ENHANCEMENT 3: CHART PREVIEW
  function previewChart() {
    if (!uploadedData.rows) return;
    const numericCols = uploadedData.columns.filter(col => !isNaN(uploadedData.rows[0][col]));
    if (numericCols.length > 0) {
      const labels = uploadedData.rows.slice(0, 10).map((r, i) => 'Row ' + i);
      const data = uploadedData.rows.slice(0, 10).map(r => r[numericCols[0]] || 0);
      if (document.getElementById('dataChart') && typeof Chart !== 'undefined') {
        new Chart(document.getElementById('dataChart'), {
          type: 'bar',
          data: { labels: labels, datasets: [{ label: numericCols[0], data: data, backgroundColor: '#2563eb' }] },
          options: { responsive: true }
        });
      }
    }
  }
  
  // ENHANCEMENT 4: DOWNLOAD CLEANED DATA
  function downloadCleanedData() {
    if (!uploadedData.rows) return;
    let csv = uploadedData.columns.join(',') + '\n';
    uploadedData.rows.forEach(row => {
      csv += uploadedData.columns.map(col => row[col] || '').join(',') + '\n';
    });
    const blob = new Blob([csv], { type: 'text/csv' });
    const url = URL.createObjectURL(blob);
    const link = document.createElement('a');
    link.href = url;
    link.download = 'cleaned_data.csv';
    link.click();
  }
  
  // Store data globally and trigger enhancements
  const originalDisplayPreview = displayPreview;
  function displayPreviewEnhanced(headers, rows) {
    uploadedData = { columns: headers, rows: rows };
    originalDisplayPreview(headers, rows);
    generateKPIs();
    buildSQL();
    previewChart();
  }
  displayPreview = displayPreviewEnhanced;

      		// DATA LAB ENHANCEMENT: Proper file upload and KPI detection
		document.getElementById("fileInput").addEventListener("change", handleFileUpload);

		function handleFileUpload(e) {
			const file = e.target.files[0];
			if (!file) return;
			document.getElementById("fileStatus").innerText = "Processing‚Ä¶";
			const ext = file.name.split(".").pop().toLowerCase();
			if (ext === "csv") {
				Papa.parse(file, {
					header: true,
					dynamicTyping: true,
					complete: function(res) {
						window.__parsedData = res.data;
						previewData(res.data);
						renderActionButtons();
						detectKPIs(res.data);
						document.getElementById("fileStatus").innerText = "File uploaded successfully";
					}
				});
			} else {
				document.getElementById("fileStatus").innerText = "Unsupported file type";
			}
		}

		function renderActionButtons() {
			const div = document.getElementById("data-actions");
			div.innerHTML = `<button id="btnAnalyze">Analyze & Generate KPIs</button> <button id="btnDownload">Download Cleaned CSV</button>`;
			document.getElementById("btnAnalyze").onclick = () => detectKPIs(window.__parsedData);
			document.getElementById("btnDownload").onclick = () => downloadCleanedCSV(window.__parsedData);
		}

		function previewData(data) {
			const box = document.getElementById("data-preview");
			if (!data || data.length === 0) return;
			let html = "<table><thead><tr>";
			Object.keys(data[0]).forEach(c => html += `<th>${c}</th>`);
			html += "</tr></thead><tbody>";
			data.slice(0, 50).forEach(r => {
				html += "<tr>";
				Object.values(r).forEach(v => html += `<td>${v}</td>`);
				html += "</tr>";
			});
			html += "</tbody></table>";
			box.innerHTML = html;
		}

		function detectKPIs(data) {
			const box = document.getElementById("kpi-output");
			if (!data || data.length === 0) return;
			const sample = data[0];
			const numCols = {};
			Object.keys(sample).forEach(col => {
				if (typeof sample[col] === "number") {
					numCols[col] = data.map(r => r[col]);
				}
			});
			let html = "";
			Object.keys(numCols).forEach(col => {
				const vals = numCols[col].filter(v => typeof v === "number");
				if (vals.length === 0) return;
				const tot = vals.reduce((a, b) => a + b, 0);
				const avg = tot / vals.length;
				const min = Math.min(...vals);
				const max = Math.max(...vals);
				html += `<div class="kpi-card"><h4>${col}</h4><p>Total: ${tot}</p><p>Average: ${avg.toFixed(2)}</p><p>Min: ${min}</p><p>Max: ${max}</p></div>`;
			});
			box.innerHTML = html || "<p>No numeric KPIs detected</p>";
		}

		function downloadCleanedCSV(data) {
			const csv = Papa.unparse(data);
			const blob = new Blob([csv], {type: "text/csv"});
			const url = URL.createObjectURL(blob);
			const a = document.createElement("a");
			a.href = url;
			a.download = "cleaned_data.csv";
			a.click();
		}

</script>

</body>
</html>
